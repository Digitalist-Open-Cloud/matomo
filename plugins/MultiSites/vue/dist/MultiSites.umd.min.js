(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue")):"function"===typeof define&&define.amd?define(["CoreHome"],t):"object"===typeof exports?exports["MultiSites"]=t(require("CoreHome"),require("vue")):e["MultiSites"]=t(e["CoreHome"],e["Vue"])})("undefined"!==typeof self?self:this,(function(e,t){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="plugins/MultiSites/vue/dist/",o(o.s="fae3")}({"19dc":function(t,o){t.exports=e},"8bbf":function(e,o){e.exports=t},fae3:function(e,t,o){"use strict";if(o.r(t),o.d(t,"AllWebsitesDashboard",(function(){return xe})),"undefined"!==typeof window){var r=window.document.currentScript,n=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(o.p=n[1])}var a=o("8bbf"),i={class:"dashboardHeader"},l={class:"card-title"},s={key:0},c={class:"notification system notification-error"},u=Object(a["createElementVNode"])("br",null,null,-1),d=Object(a["createElementVNode"])("br",null,null,-1),p=["href"],v=Object(a["createTextVNode"])(" – "),b=["href"],m=Object(a["createTextVNode"])(" – "),h=["href"],O=Object(a["createTextVNode"])(". "),f={class:"dashboardControls"},g={class:"siteSearch"},j=["placeholder"],k=["title"],S=["href"];function C(e,t,o,r,n,C){var y=Object(a["resolveComponent"])("EnrichedHeadline"),N=Object(a["resolveComponent"])("KPICardContainer"),E=Object(a["resolveComponent"])("SitesTable");return Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],null,[Object(a["createElementVNode"])("div",i,[Object(a["createElementVNode"])("h1",l,[Object(a["createVNode"])(y,{"feature-name":e.translate("MultiSites_AllWebsitesDashboardTitle")},{default:Object(a["withCtx"])((function(){return[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("MultiSites_AllWebsitesDashboardTitle")),1)]})),_:1},8,["feature-name"])])]),e.errorLoading?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",s,[Object(a["createElementVNode"])("div",c,[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("MultiSites_AllWebsitesDashboardErrorMessage"))+" ",1),u,d,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("General_NeedMoreHelp","",""))+" ",1),Object(a["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.externalRawLink("https://matomo.org/faq/troubleshooting/faq_19489/")},Object(a["toDisplayString"])(e.translate("General_Faq")),9,p),v,Object(a["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.externalRawLink("https://forum.matomo.org/")},Object(a["toDisplayString"])(e.translate("Feedback_CommunityHelp")),9,b),m,Object(a["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.externalRawLink("https://matomo.org/support-plans/")},Object(a["toDisplayString"])(e.translate("Feedback_ProfessionalHelp")),9,h),O])])):Object(a["createCommentVNode"])("",!0),Object(a["createVNode"])(N,{"is-loading":e.isLoadingKPIs,"model-value":e.kpis},null,8,["is-loading","model-value"]),Object(a["createElementVNode"])("div",f,[Object(a["createElementVNode"])("div",g,[Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{type:"text",onKeydown:t[0]||(t[0]=Object(a["withKeys"])((function(t){return e.searchSite(e.searchTerm)}),["enter"])),"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.searchTerm=t}),placeholder:e.translate("Actions_SubmenuSitesearch")},null,40,j),[[a["vModelText"],e.searchTerm]]),Object(a["createElementVNode"])("span",{class:"icon-search",onClick:t[2]||(t[2]=function(t){return e.searchSite(e.searchTerm)}),title:e.translate("General_ClickToSearch")},null,8,k)]),!e.isWidgetized&&e.isUserAllowedToAddSite?(Object(a["openBlock"])(),Object(a["createElementBlock"])("a",{key:0,class:"btn",href:e.addSiteUrl},Object(a["toDisplayString"])(e.translate("SitesManager_AddSite")),9,S)):Object(a["createCommentVNode"])("",!0)]),Object(a["createVNode"])(E,{"display-revenue":e.displayRevenue,"display-sparklines":e.displaySparklines},null,8,["display-revenue","display-sparklines"])],64)}var y=o("19dc");function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,o){return t&&E(e.prototype,t),o&&E(e,o),e}function _(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var V="desc",B="nb_visits",P=function(){function e(){var t=this;N(this,e),_(this,"fetchAbort",null),_(this,"privateState",Object(a["reactive"])({dashboardKPIs:{badges:{},evolutionPeriod:"day",hits:"?",hitsCompact:"?",hitsEvolution:"",hitsTrend:0,pageviews:"?",pageviewsCompact:"?",pageviewsEvolution:"",pageviewsTrend:0,revenue:"?",revenueCompact:"?",revenueEvolution:"",revenueTrend:0,visits:"?",visitsCompact:"?",visitsEvolution:"",visitsTrend:0},dashboardSites:[],errorLoading:!1,isLoadingKPIs:!1,isLoadingSites:!1,numSites:0,paginationCurrentPage:0,sortColumn:B,sortOrder:V})),_(this,"autoRefreshInterval",0),_(this,"autoRefreshTimeout",null),_(this,"pageSize",25),_(this,"searchTerm",""),_(this,"state",Object(a["computed"])((function(){return Object(a["readonly"])(t.privateState)}))),_(this,"numberOfPages",Object(a["computed"])((function(){return Math.ceil(t.state.value.numSites/t.pageSize-1)}))),_(this,"currentPagingOffset",Object(a["computed"])((function(){return Math.ceil(t.state.value.paginationCurrentPage*t.pageSize)}))),_(this,"paginationLowerBound",Object(a["computed"])((function(){return 0===t.state.value.numSites?0:1+t.currentPagingOffset.value}))),_(this,"paginationUpperBound",Object(a["computed"])((function(){if(0===t.state.value.numSites)return 0;var e=t.pageSize+t.currentPagingOffset.value,o=t.state.value.numSites;return e<o?e:o})))}return T(e,[{key:"reloadDashboard",value:function(){this.privateState.sortColumn=B,this.privateState.sortOrder=V,this.privateState.paginationCurrentPage=0,this.refreshData()}},{key:"navigateNextPage",value:function(){this.privateState.paginationCurrentPage!==this.numberOfPages.value&&(this.privateState.paginationCurrentPage+=1,this.refreshData(!0))}},{key:"navigatePreviousPage",value:function(){0!==this.privateState.paginationCurrentPage&&(this.privateState.paginationCurrentPage-=1,this.refreshData(!0))}},{key:"searchSite",value:function(e){this.searchTerm=e,this.privateState.paginationCurrentPage=0,this.refreshData(!0)}},{key:"setAutoRefreshInterval",value:function(e){this.autoRefreshInterval=e}},{key:"setPageSize",value:function(e){this.pageSize=e}},{key:"sortBy",value:function(e){this.privateState.sortColumn===e?this.privateState.sortOrder="desc"===this.privateState.sortOrder?"asc":"desc":this.privateState.sortOrder="label"===e?"asc":"desc",this.privateState.sortColumn=e,this.refreshData(!0)}},{key:"cancelAutoRefresh",value:function(){this.autoRefreshTimeout&&(clearTimeout(this.autoRefreshTimeout),this.autoRefreshTimeout=null)}},{key:"refreshData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.fetchAbort&&(this.fetchAbort.abort(),this.fetchAbort=null,this.cancelAutoRefresh()),this.fetchAbort=new AbortController,this.privateState.errorLoading=!1,this.privateState.isLoadingKPIs=!t,this.privateState.isLoadingSites=!0;var o={method:"MultiSites.getAllWithGroups",filter_limit:this.pageSize,filter_offset:this.currentPagingOffset.value,filter_sort_column:this.privateState.sortColumn,filter_sort_order:this.privateState.sortOrder,format_metrics:0,showColumns:["hits_evolution","hits_evolution_trend","label","hits","nb_pageviews","nb_visits","pageviews_evolution","pageviews_evolution_trend","revenue","revenue_evolution","revenue_evolution_trend","visits_evolution","visits_evolution_trend"].join(",")};return this.searchTerm&&(o.pattern=this.searchTerm),y["AjaxHelper"].fetch(o,{abortController:this.fetchAbort,createErrorNotification:!1}).then((function(o){t||(e.updateDashboardKPIs(o),y["Matomo"].postEvent("MultiSites.DashboardKPIs.updated",{parameters:(new y["AjaxHelper"]).mixinDefaultGetParams({filter_limit:e.pageSize,filter_offset:e.currentPagingOffset.value,filter_sort_column:e.privateState.sortColumn,filter_sort_order:e.privateState.sortOrder,pattern:e.searchTerm}),kpis:e.privateState.dashboardKPIs})),e.updateDashboardSites(o)})).catch((function(){e.privateState.dashboardSites=[],e.privateState.errorLoading=!0})).finally((function(){e.privateState.isLoadingKPIs=!1,e.privateState.isLoadingSites=!1,e.fetchAbort=null,e.startAutoRefresh()}))}},{key:"startAutoRefresh",value:function(){var e=this;if(this.cancelAutoRefresh(),!(this.autoRefreshInterval<=0)){var t;try{t=y["Periods"].parse(y["Matomo"].period,y["Matomo"].currentDateString)}catch(o){}t&&t.containsToday()&&(this.autoRefreshTimeout=setTimeout((function(){e.autoRefreshTimeout=null,e.refreshData()}),1e3*this.autoRefreshInterval))}}},{key:"updateDashboardKPIs",value:function(e){this.privateState.dashboardKPIs={badges:{hits:null,pageviews:null,revenue:null,visits:null},evolutionPeriod:y["Matomo"].period,hits:y["NumberFormatter"].formatNumber(e.totals.hits),hitsCompact:y["NumberFormatter"].formatNumberCompact(e.totals.hits),hitsEvolution:y["NumberFormatter"].calculateAndFormatEvolution(e.totals.hits,e.totals.previous_hits,!0),hitsTrend:Math.sign(e.totals.hits-e.totals.previous_hits),pageviews:y["NumberFormatter"].formatNumber(e.totals.nb_pageviews),pageviewsCompact:y["NumberFormatter"].formatNumberCompact(e.totals.nb_pageviews),pageviewsEvolution:y["NumberFormatter"].calculateAndFormatEvolution(e.totals.nb_pageviews,e.totals.previous_nb_pageviews,!0),pageviewsTrend:Math.sign(e.totals.nb_pageviews-e.totals.previous_nb_pageviews),revenue:y["NumberFormatter"].formatCurrency(e.totals.revenue,""),revenueCompact:y["NumberFormatter"].formatCurrencyCompact(e.totals.revenue,""),revenueEvolution:y["NumberFormatter"].calculateAndFormatEvolution(e.totals.revenue,e.totals.previous_revenue,!0),revenueTrend:Math.sign(e.totals.revenue-e.totals.previous_revenue),visits:y["NumberFormatter"].formatNumber(e.totals.nb_visits),visitsCompact:y["NumberFormatter"].formatNumberCompact(e.totals.nb_visits),visitsEvolution:y["NumberFormatter"].calculateAndFormatEvolution(e.totals.nb_visits,e.totals.previous_nb_visits,!0),visitsTrend:Math.sign(e.totals.nb_visits-e.totals.previous_nb_visits)}}},{key:"updateDashboardSites",value:function(e){this.privateState.dashboardSites=e.sites,this.privateState.numSites=e.numSites}}]),e}(),M=new P,w={class:"kpiCardContainer"},D={key:0,class:"kpiCard kpiCardLoading"},L=Object(a["createElementVNode"])("div",{class:"kpiCardTitle"}," ",-1),x={class:"kpiCardValue"},F=Object(a["createElementVNode"])("div",{class:"kpiCardEvolution"},[Object(a["createElementVNode"])("span",{class:"kpiCardEvolutionTrend"}," ")],-1),A={key:0,class:"kpiCardBadge"};function R(e,t,o,r,n,i){var l=Object(a["resolveComponent"])("MatomoLoader"),s=Object(a["resolveComponent"])("KPICard");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",w,[e.isLoading?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",D,[L,Object(a["createElementVNode"])("div",x,[Object(a["createVNode"])(l)]),F,e.hasKpiBadge?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",A," ")):Object(a["createCommentVNode"])("",!0)])):(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],{key:1},Object(a["renderList"])(e.kpis,(function(t,o){return Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],{key:"kpi-card-".concat(o)},[o>0?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:0,class:Object(a["normalizeClass"])({kpiCardDivider:!0,kpiCardDividerBadge:e.hasKpiBadge})}," ",2)):Object(a["createCommentVNode"])("",!0),Object(a["createVNode"])(s,{"model-value":t},null,8,["model-value"])],64)})),128))])}var G={class:"kpiCard"},I={class:"kpiCardTitle"},z={style:{display:"none"},ref:"kpiCardTooltipTemplate"},K={role:"tooltip"},H=["title"],U={class:"kpiCardEvolution"},q={key:1,class:"kpiCardEvolution"},W=Object(a["createElementVNode"])("span",{class:"kpiCardEvolutionTrend"}," ",-1),$=[W],J=["title","innerHTML"];function Y(e,t,o,r,n,i){var l=Object(a["resolveDirective"])("tooltips");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",G,[Object(a["createElementVNode"])("div",I,[Object(a["createElementVNode"])("span",{class:Object(a["normalizeClass"])("kpiCardIcon ".concat(e.kpi.icon))},null,2),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate(e.kpi.title)),1)]),Object(a["createElementVNode"])("div",z,[Object(a["createElementVNode"])("div",K,[Object(a["createElementVNode"])("h3",null,Object(a["toDisplayString"])(e.translate(e.kpi.title)),1),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.kpi.value),1)])],512),Object(a["withDirectives"])(Object(a["createElementVNode"])("div",{class:"kpiCardValue",title:e.kpi.value},[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.kpi.valueCompact),1)],8,H),[[l,{duration:200,delay:200,content:e.tooltipContent}]]),Object(a["createElementVNode"])("div",U,[""!==e.kpi.evolutionValue?(Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],{key:0},[Object(a["createElementVNode"])("span",{class:Object(a["normalizeClass"])("kpiCardEvolutionTrend ".concat(e.evolutionTrendClass))},[Object(a["createElementVNode"])("span",{class:Object(a["normalizeClass"])("kpiCardEvolutionIcon ".concat(e.evolutionTrendIcon))},null,2),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.kpi.evolutionValue)+"  ",1)],2),Object(a["createElementVNode"])("span",null,Object(a["toDisplayString"])(e.translate(e.evolutionTrendFrom)),1)],64)):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",q,$))]),e.kpi.badge?Object(a["withDirectives"])((Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:0,class:"kpiCardBadge",title:e.kpi.badge.title,innerHTML:e.$sanitize(e.kpi.badge.label)},null,8,J)),[[l,{duration:200,delay:200}]]):Object(a["createCommentVNode"])("",!0)])}var Q=Object(a["defineComponent"])({directives:{Tooltips:y["Tooltips"]},props:{modelValue:{type:Object,required:!0}},computed:{tooltipContent:function(){var e=this;return function(){var t;return(null===(t=e.$refs.kpiCardTooltipTemplate)||void 0===t?void 0:t.innerHTML)||""}},evolutionTrendFrom:function(){switch(this.kpi.evolutionPeriod){case"day":return"MultiSites_EvolutionFromPreviousDay";case"week":return"MultiSites_EvolutionFromPreviousWeek";case"month":return"MultiSites_EvolutionFromPreviousMonth";case"year":return"MultiSites_EvolutionFromPreviousYear";default:return"MultiSites_EvolutionFromPreviousPeriod"}},evolutionTrendClass:function(){return 1===this.kpi.evolutionTrend?"kpiTrendPositive":-1===this.kpi.evolutionTrend?"kpiTrendNegative":"kpiTrendNeutral"},evolutionTrendIcon:function(){return 1===this.kpi.evolutionTrend?"icon-chevron-up":-1===this.kpi.evolutionTrend?"icon-chevron-down":"icon-circle"},kpi:function(){return this.modelValue}}});Q.render=Y;var X=Q,Z=Object(a["defineComponent"])({components:{MatomoLoader:y["MatomoLoader"],KPICard:X},props:{isLoading:Boolean,modelValue:{type:Array,required:!0}},computed:{hasKpiBadge:function(){return this.kpis.some((function(e){return!!e.badge}))},kpis:function(){return this.modelValue}}});Z.render=R;var ee=Z,te={class:"sitesTableContainer"},oe={class:"card-table dataTable sitesTable"},re={class:"sitesTableEvolutionSelector"},ne=["value"],ae={value:"hits_evolution"},ie={value:"visits_evolution"},le={value:"pageviews_evolution"},se={key:0,value:"revenue_evolution"},ce={key:0},ue={class:"sitesTableLoading",colspan:"7"},de={key:0,class:"sitesTablePagination"},pe={class:"dataTablePages"};function ve(e,t,o,r,n,i){var l=Object(a["resolveComponent"])("MatomoLoader"),s=Object(a["resolveComponent"])("SitesTableSite");return Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],null,[Object(a["createElementVNode"])("div",te,[Object(a["createElementVNode"])("table",oe,[Object(a["createElementVNode"])("thead",null,[Object(a["createElementVNode"])("tr",null,[Object(a["createElementVNode"])("th",{onClick:t[0]||(t[0]=function(t){return e.sortBy("label")}),class:"label"},[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("General_Website"))+" ",1),"label"===e.sortColumn?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",{key:0,class:Object(a["normalizeClass"])(e.sortColumnClass)},null,2)):Object(a["createCommentVNode"])("",!0)]),Object(a["createElementVNode"])("th",{onClick:t[1]||(t[1]=function(t){return e.sortBy("nb_visits")})},["nb_visits"===e.sortColumn?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",{key:0,class:Object(a["normalizeClass"])(e.sortColumnClass)},null,2)):Object(a["createCommentVNode"])("",!0),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("General_ColumnNbVisits")),1)]),Object(a["createElementVNode"])("th",{onClick:t[2]||(t[2]=function(t){return e.sortBy("nb_pageviews")})},["nb_pageviews"===e.sortColumn?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",{key:0,class:Object(a["normalizeClass"])(e.sortColumnClass)},null,2)):Object(a["createCommentVNode"])("",!0),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("General_ColumnPageviews")),1)]),Object(a["createElementVNode"])("th",{onClick:t[3]||(t[3]=function(t){return e.sortBy("hits")})},["hits"===e.sortColumn?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",{key:0,class:Object(a["normalizeClass"])(e.sortColumnClass)},null,2)):Object(a["createCommentVNode"])("",!0),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("General_ColumnHits")),1)]),e.displayRevenue?(Object(a["openBlock"])(),Object(a["createElementBlock"])("th",{key:0,onClick:t[4]||(t[4]=function(t){return e.sortBy("revenue")})},["revenue"===e.sortColumn?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",{key:0,class:Object(a["normalizeClass"])(e.sortColumnClass)},null,2)):Object(a["createCommentVNode"])("",!0),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("General_ColumnRevenue")),1)])):Object(a["createCommentVNode"])("",!0),Object(a["createElementVNode"])("th",{onClick:t[5]||(t[5]=function(t){return e.sortBy(e.evolutionSelector)})},[e.sortColumn===e.evolutionSelector?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",{key:0,class:Object(a["normalizeClass"])(e.sortColumnClass)},null,2)):Object(a["createCommentVNode"])("",!0),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("MultiSites_Evolution")),1)]),Object(a["createElementVNode"])("th",re,[Object(a["createElementVNode"])("select",{class:"browser-default",value:e.evolutionSelector,onChange:t[6]||(t[6]=function(t){return e.changeEvolutionSelector(t.target.value)})},[Object(a["createElementVNode"])("option",ae,Object(a["toDisplayString"])(e.translate("General_ColumnHits")),1),Object(a["createElementVNode"])("option",ie,Object(a["toDisplayString"])(e.translate("General_ColumnNbVisits")),1),Object(a["createElementVNode"])("option",le,Object(a["toDisplayString"])(e.translate("General_ColumnPageviews")),1),e.displayRevenue?(Object(a["openBlock"])(),Object(a["createElementBlock"])("option",se,Object(a["toDisplayString"])(e.translate("General_ColumnRevenue")),1)):Object(a["createCommentVNode"])("",!0)],40,ne)])])]),Object(a["createElementVNode"])("tbody",null,[e.isLoading?(Object(a["openBlock"])(),Object(a["createElementBlock"])("tr",ce,[Object(a["createElementVNode"])("td",ue,[Object(a["createVNode"])(l)])])):(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],{key:1},Object(a["renderList"])(e.sites,(function(t){return Object(a["openBlock"])(),Object(a["createBlock"])(s,{"display-revenue":e.displayRevenue,"evolution-metric":e.evolutionMetric,key:"site-".concat(t.idsite),"model-value":t,"display-sparkline":e.displaySparklines,"sparkline-metric":e.sparklineMetric},null,8,["display-revenue","evolution-metric","model-value","display-sparkline","sparkline-metric"])})),128))])])]),!e.isLoading||e.paginationUpperBound>0?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",de,[Object(a["withDirectives"])(Object(a["createElementVNode"])("span",{class:"dataTablePrevious",onClick:t[7]||(t[7]=function(t){return e.navigatePreviousPage()})}," « "+Object(a["toDisplayString"])(e.translate("General_Previous")),513),[[a["vShow"],0!==e.paginationCurrentPage]]),Object(a["createElementVNode"])("span",pe,Object(a["toDisplayString"])(e.translate("General_Pagination",e.paginationLowerBound,e.paginationUpperBound,e.numberOfFilteredSites)),1),Object(a["withDirectives"])(Object(a["createElementVNode"])("span",{class:"dataTableNext",onClick:t[8]||(t[8]=function(t){return e.navigateNextPage()})},Object(a["toDisplayString"])(e.translate("General_Next"))+" » ",513),[[a["vShow"],e.paginationCurrentPage<e.paginationMaxPage]])])):Object(a["createCommentVNode"])("",!0)],64)}var be={class:"label"},me=["href","title"],he=Object(a["createElementVNode"])("span",{class:"icon icon-outlink"},null,-1),Oe=[he],fe=["href"],ge={key:1,class:"value"},je={class:"value"},ke={class:"value"},Se={class:"value"},Ce={key:0},ye={class:"value"},Ne=["colspan"],Ee=["src"],Te={key:1,class:"sitesTableSparkline"},_e=["href","title"],Ve=["src"];function Be(e,t,o,r,n,i){return Object(a["openBlock"])(),Object(a["createElementBlock"])("tr",{class:Object(a["normalizeClass"])({sitesTableGroup:!!e.site.isGroup,sitesTableGroupSite:!e.site.isGroup&&!!e.site.group,sitesTableSite:!e.site.isGroup&&!e.site.group})},[Object(a["createElementVNode"])("td",be,[e.site.isGroup?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",ge,Object(a["toDisplayString"])(e.siteLabel),1)):(Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],{key:0},[Object(a["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.site.main_url,title:e.translate("General_GoTo",e.site.main_url)},Oe,8,me),Object(a["createElementVNode"])("a",{title:"View reports",class:"value",href:e.dashboardUrl},Object(a["toDisplayString"])(e.siteLabel),9,fe)],64))]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("span",je,Object(a["toDisplayString"])(e.formatNumber(e.site.nb_visits)),1)]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("span",ke,Object(a["toDisplayString"])(e.formatNumber(e.site.nb_pageviews)),1)]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("span",Se,Object(a["toDisplayString"])(e.formatNumber(e.site.hits)),1)]),e.displayRevenue?(Object(a["openBlock"])(),Object(a["createElementBlock"])("td",Ce,[Object(a["createElementVNode"])("span",ye,Object(a["toDisplayString"])(e.formatCurrency(e.site.revenue,e.site.currencySymbol||"")),1)])):Object(a["createCommentVNode"])("",!0),Object(a["createElementVNode"])("td",{colspan:e.displaySparkline?1:2},[!e.site.isGroup&&e.sparklineMetric in e.site?(Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],{key:0},[Object(a["createElementVNode"])("img",{src:e.evolutionIconSrc,alt:""},null,8,Ee),Object(a["createElementVNode"])("span",{class:Object(a["normalizeClass"])(e.evolutionTrendClass)},Object(a["toDisplayString"])(e.calculateAndFormatEvolution(e.site[e.sparklineMetric],e.site["previous_".concat(e.sparklineMetric)]*e.site.ratio,!0)),3)],64)):Object(a["createCommentVNode"])("",!0)],8,Ne),e.displaySparkline?(Object(a["openBlock"])(),Object(a["createElementBlock"])("td",Te,[e.site.isGroup?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("a",{key:0,rel:"noreferrer noopener",target:"_blank",href:e.dashboardUrl,title:e.translate("General_GoTo",e.translate("Dashboard_DashboardOf",e.siteLabel))},[Object(a["createElementVNode"])("img",{alt:"",width:"100",height:"25",src:e.evolutionSparklineSrc},null,8,Ve)],8,_e))])):Object(a["createCommentVNode"])("",!0)],2)}var Pe=Object(a["defineComponent"])({props:{displayRevenue:{type:Boolean,required:!0},evolutionMetric:{type:String,required:!0},modelValue:{type:Object,required:!0},sparklineMetric:String,displaySparkline:Boolean},computed:{dashboardUrl:function(){var e=y["MatomoUrl"].stringify({module:"CoreHome",action:"index",date:y["Matomo"].currentDateString,period:y["Matomo"].period,idSite:this.site.idsite});return"?".concat(e).concat(this.tokenParam)},evolutionIconSrc:function(){return 1===this.evolutionTrend?"plugins/MultiSites/images/arrow_up.png":-1===this.evolutionTrend?"plugins/MultiSites/images/arrow_down.png":"plugins/MultiSites/images/stop.png"},evolutionSparklineSrc:function(){var e=y["Matomo"].currentDateString;if("range"!==y["Matomo"].period){var t=y["Range"].getLastNRange(y["Matomo"].period,"30",y["Matomo"].currentDateString),o=t.startDate,r=t.endDate;e="".concat(Object(y["format"])(o),",").concat(Object(y["format"])(r))}var n=y["MatomoUrl"].stringify({module:"MultiSites",action:"getEvolutionGraph",date:e,period:y["Matomo"].period,idSite:this.site.idsite,columns:this.sparklineMetric,evolutionBy:this.sparklineMetric,colors:JSON.stringify(y["Matomo"].getSparklineColors()),viewDataTable:"sparkline"});return"?".concat(n).concat(this.tokenParam)},evolutionTrend:function(){var e="".concat(this.evolutionMetric,"_trend");return this.site[e]},evolutionTrendClass:function(){return 1===this.evolutionTrend?"evolutionTrendPositive":-1===this.evolutionTrend?"evolutionTrendNegative":""},site:function(){return this.modelValue},siteLabel:function(){return y["Matomo"].helper.htmlDecode(this.site.label)},tokenParam:function(){var e=y["MatomoUrl"].urlParsed.value.token_auth;return e?"&token_auth=".concat(e):""}}});Pe.render=Be;var Me=Pe,we=Object(a["defineComponent"])({components:{MatomoLoader:y["MatomoLoader"],SitesTableSite:Me},props:{displayRevenue:{type:Boolean,required:!0},displaySparklines:{type:Boolean,required:!0}},data:function(){return{evolutionSelector:"visits_evolution"}},computed:{errorLoading:function(){return M.state.value.errorLoading},errorShowProfessionalHelp:function(){return y["Matomo"].config&&y["Matomo"].config.are_ads_enabled},evolutionMetric:function(){return this.evolutionSelector},isLoading:function(){return M.state.value.isLoadingSites},numberOfFilteredSites:function(){return M.state.value.numSites},paginationCurrentPage:function(){return M.state.value.paginationCurrentPage},paginationLowerBound:function(){return M.paginationLowerBound.value},paginationUpperBound:function(){return M.paginationUpperBound.value},paginationMaxPage:function(){return M.numberOfPages.value},sites:function(){return M.state.value.dashboardSites},sortColumn:function(){return M.state.value.sortColumn},sortColumnClass:function(){return{sitesTableSort:!0,sitesTableSortAsc:"asc"===this.sortOrder,sitesTableSortDesc:"desc"===this.sortOrder}},sortOrder:function(){return M.state.value.sortOrder},sparklineMetric:function(){switch(this.evolutionMetric){case"hits_evolution":return"hits";case"pageviews_evolution":return"nb_pageviews";case"revenue_evolution":return"revenue";case"visits_evolution":return"nb_visits";default:return""}}},methods:{changeEvolutionSelector:function(e){this.evolutionSelector=e,this.sortBy(e)},navigateNextPage:function(){M.navigateNextPage()},navigatePreviousPage:function(){M.navigatePreviousPage()},sortBy:function(e){M.sortBy(e)}}});we.render=ve;var De=we,Le=Object(a["defineComponent"])({components:{EnrichedHeadline:y["EnrichedHeadline"],KPICardContainer:ee,SitesTable:De},props:{autoRefreshInterval:{type:Number,required:!0},displayRevenue:{type:Boolean,required:!0},displaySparklines:{type:Boolean,required:!0},isWidgetized:{type:Boolean,required:!0},pageSize:{type:Number,required:!0}},data:function(){return{searchTerm:""}},mounted:function(){Object(a["watch"])((function(){return y["MatomoUrl"].hashParsed.value}),(function(){return M.reloadDashboard()})),M.setAutoRefreshInterval(this.autoRefreshInterval),M.setPageSize(this.pageSize),M.reloadDashboard()},computed:{addSiteUrl:function(){return"?".concat(y["MatomoUrl"].stringify(Object.assign(Object.assign(Object.assign({},y["MatomoUrl"].urlParsed.value),y["MatomoUrl"].hashParsed.value),{},{module:"SitesManager",action:"index",showaddsite:"1"})))},isLoadingKPIs:function(){return M.state.value.isLoadingKPIs},errorLoading:function(){return M.state.value.errorLoading},kpis:function(){var e,t,o,r,n=M.state.value.dashboardKPIs,a=[{badge:(null===(e=n.badges)||void 0===e?void 0:e.visits)||null,icon:"icon-user",title:"MultiSites_TotalVisits",value:n.visits,valueCompact:n.visitsCompact,evolutionPeriod:n.evolutionPeriod,evolutionTrend:n.visitsTrend,evolutionValue:n.visitsEvolution},{badge:(null===(t=n.badges)||void 0===t?void 0:t.pageviews)||null,icon:"icon-show",title:"MultiSites_TotalPageviews",value:n.pageviews,valueCompact:n.pageviewsCompact,evolutionPeriod:n.evolutionPeriod,evolutionTrend:n.pageviewsTrend,evolutionValue:n.pageviewsEvolution},{badge:(null===(o=n.badges)||void 0===o?void 0:o.hits)||null,icon:"icon-hits",title:"MultiSites_TotalHits",value:n.hits,valueCompact:n.hitsCompact,evolutionPeriod:n.evolutionPeriod,evolutionTrend:n.hitsTrend,evolutionValue:n.hitsEvolution}];this.displayRevenue&&a.push({badge:(null===(r=n.badges)||void 0===r?void 0:r.revenue)||null,icon:"icon-dollar-sign",title:"General_TotalRevenue",value:n.revenue,valueCompact:n.revenueCompact,evolutionPeriod:n.evolutionPeriod,evolutionTrend:n.revenueTrend,evolutionValue:n.revenueEvolution});return a},isUserAllowedToAddSite:function(){return y["Matomo"].hasSuperUserAccess}},methods:{searchSite:function(e){M.searchSite(e)}}});Le.render=C;var xe=Le;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=MultiSites.umd.min.js.map